<!DOCTYPE  html>
<html>
<head>
    <title>Canvas Test</title>
    <style>
        .canvas-container{
            position: relative;
        }

        .canvas-photo {
            width: 100%;/*1170px;
            height: 835px;*/
        }

        .lato {
            font-family: 'Lato', sans-serif;
        }

        .creepster {
            font-family: 'Creepster', serif;
        }

        .griffy {
            font-family: 'Griffy', serif;
        }

        .rye {
            font-family: 'Rye', serif;
        }

        .satisfy {
            font-family: 'Satisfy', cursive;
        }

        #start {
            position: absolute;
            top: 35%;
            left: 44%;
            color: #ffffff;
            font-size: 150px;
            text-shadow: 2px 3px 10px #333333;
            cursor: pointer;
        }

        div.hidden, i.hidden, .hidden {
            display: none;
        }

        .hide {
            position: absolute;
            left: -9999px;
        }

        #backgrounds  img {
            max-width: 100px;
            cursor: pointer;
        }

        .options {
            margin-top: 5px;
            margin-bottom: 5px;
        }

    </style>

    <link href="http://fonts.googleapis.com/css?family=Lato|Rye|Griffy" rel="stylesheet" type="text/css">
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.1/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.2/css/bootstrap.min.css" rel="stylesheet" type="text/css">
</head>
<body>
    <div class="container">
        <div class="row" id="webcam-allow">
            <i class="fa fa-arrow-up"></i> Please Click Allow to Start the Photo Strip <i class="fa fa-arrow-up"></i>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <h1 class="lato">Create Your Own Photo Strip</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div id="canvas-container" class="canvas-container">
                    <canvas id="final" width="1190" height="850" class="canvas-photo"></canvas>
                    <i id="start" class="fa fa-camera-retro fa-3x hidden"></i>
                </div>
            </div>
            <div class="col-xs-12 options" >
                Backgrounds
                <ul id="backgrounds" class="list-unstyled list-inline"></ul>
            </div>
            <div class="col-xs-12 options">
                Camera Effects
                <select name="filters" id="filters"></select>
            </div>
            <div class="col-xs-12 options">
                Message
                <input type="text" id="greetings" class="rye" value="">
                <ul id="fonts" class="hide"></ul>
            </div>
        </div>
        <div class="row">
            I will need to put my footer stuff here.
        </div>
    </div>
    <script type="text/javascript" src="http://evanw.github.com/glfx.js/glfx.js"></script>
    <script src="wcvj.js"></script>
    <script src="photo.js"></script>
</body>
<script>

/*



    var allow = document.getElementById('webcam-allow');
    var img = new Image();
    img.src = 'lobster_dog.jpg';
    var canvas = document.getElementById('final');
    var canvas_container = document.getElementById('canvas-container');
    var ctx = canvas.getContext('2d');
    var layered = new LayeredCanvas(canvas);
    var backCanvas = document.createElement('canvas');
    backCanvas.width = 540;
    backCanvas.height = 480;

    var textCanvas = document.createElement('canvas');
    textCanvas.width = 540;
    textCanvas.height = 480;

    var countDown = document.createElement('canvas');
    countDown.width = 1190;
    countDown.height = 850;

    layered.addLayer(new Layer(NewCanvas(1190, 850, "rgb(255,255,255)"), 0, 0), 'Base');
    layered.addLayer(new Layer(NewCanvas(540, 360, "rgb(0,0,0)"), 0, 0), 'Panel1');
    layered.addLayer(new Layer(NewCanvas(640, 360,"rgb(0,0,0)"), 550, 0), 'Panel2');
    layered.addLayer(new Layer(NewCanvas(640, 480, "rgb(0,0,0)"), 0, 370), 'Panel3');
    layered.addLayer(new Layer(backCanvas, 650, 370), 'Background');
    layered.addLayer(new Layer(textCanvas, 650, 370), 'Text');
    layered.addLayer(new Layer(countDown, 0, 0), 'CountDown');

    var cd = layered.getLayerByName('CountDown');

    //img.addEventListener('load', drawBackground);

    img.onload = function()
    {
        var background = layered.getLayerByName('Background');
        var ratio = img.width / background.width;
        background.ctx.drawImage(img, 0, 0, img.width / ratio, img.height / ratio) ;
        background.renderOnce = true;
    }*/

    /*requestAnimFrame(FullDraw);

    function drawBackground(img) {
        var background = layered.getLayerByName('Background');
        var ratio = img.width / background.width;
        background.ctx.drawImage(img, 0, 0, img.width / ratio, img.height / ratio) ;
        background.renderOnce = true;
    };

    function FullDraw()
    {
        layered.render();
        requestAnimFrame(FullDraw);
    }

    function NewCanvas(width, height, fill){
        var canv = document.createElement('canvas');
        canv.width = width;
        canv.height = height;
        var cb_ctx = canv.getContext('2d');
        cb_ctx.fillStyle = fill; //"rgb(200,0,0)"
        cb_ctx.fillRect(0,0, width, height);

        return canv;
    }



    var a = wcvj.webcam('a', {glfx: true});
    a.video.addEventListener('canplay', function(e){
        start.classList.toggle('hidden');
        allow.classList.add('hidden');
        cd.clearCanvas();
        function test(ctx){
            ctx.drawImage(a.canvas, 50, 50, 540, 360, 0,0, 540, 360);
        };

        function full(ctx){
            ctx.drawImage(a.canvas, 0, 0);
        }

        layered.getLayerByName('Panel1').draw = test;
        layered.getLayerByName('Panel2').draw = full;
        layered.getLayerByName('Panel3').draw = full;

    });

    function PanelCount(count, panel) {
        if (panel === 1) {
            layered.getLayerByName('CountDown').addTextBottomRight(count +'', 'Griffy', 50, 510, 340);
        }
         if (panel === 2) {
            layered.getLayerByName('CountDown').addTextBottomRight(count +'', 'Griffy', 50, 1160, 340);
        }
         if (panel === 3) {
            layered.getLayerByName('CountDown').addTextBottomRight(count +'', 'Griffy', 50, 610, 840);
        }
    };

    function Smile() {
        layered.getLayerByName('CountDown').addText("\uf118", 'FontAwesome', 200, 520, 420);
    };

    function photoCountDown(count, panel){
        if(count > 0 && panel <= 3) {
            PanelCount(count, panel);
            count = count - 1;
            setTimeout(function() {photoCountDown(count, panel)}, 1000);
        }else{
            if (panel <= 3) {
                Smile();
                a.update();
                layered.getLayerByName('Panel' + panel).done = true;
                panel += 1;
                count = Settings.photoTime;
                setTimeout(function() {photoCountDown(count, panel)}, 1000);
            }else{
                layered.getLayerByName('CountDown').addText('', 'Griffy', 10, 0, 0);
                layered.getLayerByName('CountDown').clearCanvas();
                layered.render();
                autoDownload('PhotoDownload_' + (Math.floor(new Date().getTime() / 10000)) + '.jpg', layered.getJPG(0.9));
                layered.getLayerByName('CountDown').addText('Please Wait', 'Griffy', 50, 450, 380);
                setTimeout(photoReset, 3000);
            }
        }
    };

    function autoDownload(name, imageData) {
        var a = document.createElement('a');
			a.setAttribute('href', imageData);
			a.setAttribute('target', '_blank');
			a.setAttribute('download',  name);
            backgrounds.appendChild(a);
			var e = document.createEvent('MouseEvents');
			e.initEvent('click', true, true);
			a.dispatchEvent(e);
    };

    function photoReset() {
        layered.getLayerByName('CountDown').clearCanvas();
        layered.resetLayers();
        start.classList.toggle('hidden');
    };

    var start = document.getElementById('start'),
    filters = document.getElementById('filters'),
    fontList = document.getElementById(('fonts')),
    greetings = document.getElementById('greetings'),
    backgrounds = document.getElementById(('backgrounds'));

    function loadFilters() {
        for(var i=0; i<Settings.filters.length; i++) {
            filters.options[filters.options.length] = new Option(Settings.filters[i][1], i);
        }
    };

    function loadFonts() {
        for(var i=0;i<Settings.fontOptions.length;i++)
        {
            var li = document.createElement('li');
            li.setAttribute('data-size', Settings.fontOptions[i][1]);
            li.setAttribute('style', 'font-family: "' + Settings.fontOptions[i][0] + '"');
            li.innerHTML = Settings.fontOptions[i][0];
            fontList.appendChild(li);
        }
    };

    function changeGreetingText(font, fontSize) {
        var text = layered.getLayerByName('Text');
        text.addCenterText(greetings.value, font, fontSize);
    };

    function loadBackgrounds() {
        for (var i=0;i<Settings.bgOptions.length;i++) {
            var li = document.createElement('li');
            var img = new Image();
            img.crossOrigin = '';
            img.src = Settings.bgOptions[i];
            li.appendChild(img);
            backgrounds.appendChild(li);
        }
    };

    loadFilters();
    loadFonts();
    loadBackgrounds();

    start.addEventListener('click', function(e){
        photoCountDown(Settings.photoTime, 1);
        start.classList.toggle('hidden');
    });

    filters.addEventListener('change', function(e){
        a.setFilter(Settings.filters[filters.selectedIndex][0]);
    });

    /*fontList.addEventListener('click', function(e){
        if (e.target.tagName === 'LI') {
            console.log(e);
            Settings.fontChosen = e.target.innerHTML;
            Settings.fontSizeChosen = e.target.getAttribute('data-size');
            changeGreetingText(e.target.innerHTML, e.target.getAttribute('data-size'));
        }
    });*/

    /*greetings.addEventListener('change', function(e){
        changeGreetingText(Settings.fontChosen, Settings.fontSizeChosen);
    });

    backgrounds.addEventListener('click', function(e){
        if (e.target.tagName === 'IMG') {
            drawBackground(e.target);
        }
    });*/

</script>
</html>